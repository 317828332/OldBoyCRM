{% extends "adminlte/common_list.html" %}
{% load adminlte_tags %}
{% load static %}
{% block content_title %}
    <h5>{{ page_title }}</h5>
{% endblock %}

{% block base_head_style %}
    <style type="text/css">
        input[type='checkbox'] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
    </style>
{% endblock %}

{% block content %}
    <div class="row" id="mydataPageVue">

    {% if mode == 1 %}
        <div class="box col-xs-12 col-sm-12">
            <h4>dev 任务操作</h4>
                <button class="btn btn-primary"
                        v-on:click="restart_pt_deploy">
                    <i class="fa fa-plus"></i>
                    普通-重新部署
                </button>
                <button class="btn btn-primary"
                        v-on:click="restart_qz_deploy">
                    <i class="fa fa-plus"></i>
                    强制-重新部署
                </button>
                <button class="btn btn-primary"
                        v-on:click="restart_back_end">
                    <i class="fa fa-plus"></i>
                    重启-后端-全部服务
                </button>
            <H1></H1>
        </div>
    {% endif %}
    {% if mode == 2 %}
        <div class="box col-xs-12 col-sm-12">
            <div class="col-xs-12 col-sm-12">
                <h4>qa 任务操作</h4>
                <button class="btn btn-primary"
                        v-on:click="restart_pt_deploy">
                    <i class="fa fa-plus"></i>
                    普通-重新部署
                </button>
                <button class="btn btn-primary"
                        v-on:click="restart_qz_deploy">
                    <i class="fa fa-plus"></i>
                    强制-重新部署
                </button>
                <button class="btn btn-primary"
                        v-on:click="restart_back_end">
                    <i class="fa fa-plus"></i>
                    重启-后端-全部服务
                </button>
                <h1></h1>
            </div>
        </div>
    {% endif %}
    {% if mode == 3 %}
        <div class="box col-xs-12 col-sm-12">
            <div class="col-xs-12 col-sm-12">
                <h4>prd 任务操作</h4>
                <button class="btn btn-primary"
                        data-pc="1"
                        v-on:click="deploy_prd">
                    <i class="fa fa-plus"></i>
                    第一批次
                </button>
                <button class="btn btn-primary"
                        data-pc="2"
                        v-on:click="deploy_prd">
                    <i class="fa fa-plus"></i>
                    第二批次
                </button>
                <button class="btn btn-primary"
                        data-pc="3"
                        v-on:click="deploy_prd">
                    <i class="fa fa-plus"></i>
                    第二批次
                </button>
                <h1></h1>
            </div>
        </div>
    {% endif %}
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <div class="row">
                        <div class="col-xs-12 col-sm-12">
                            <button type="button" class="btn btn-circle blue-hoki" >ID:<a id="nid">{{ nid }}</a></button>
                            <button type="button" class="btn btn-circle blue-madison">关联任务总数:{!! items.count !!}</button>
                            <h4>svn_tags: {!! items.svn_tags !!}</h4>
                            <h4>类型: {!! items.mode !!}</h4>
                            <h4>涉及主机:
                                <h5>
                                    {!! items.hosts !!}
                                    <a href="javascript:void(0);"
                                       data-pk="{{ nid }}"
                                       v-on:click="post_sf">
                                        释放主机
                                    </a>
                                </h5></h4>
                            <div>
                                <h4>关联项目:</h4>
                                <div>{!! items.xmname !!}</div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
     <div class="row" id="commonDataTableRow">
        <input type="hidden" name="my_id" id="my_id"
       value="{{ my_id }}"/>
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <div class="row">
                        {% if list_filter %}
                        <div class="col-xs-12 col-sm-12">
                            <div id='sl-key' class="sl-key">
                                <h4>筛选器</h4>
                                {% for k in list_filter %}
                                    <span id="list_filter_{{ k }}">{{ k.verbose_name }} 选项:</span>
                                    <select onchange='commonListPageVue.search(this)' name="{{ k }}">
                                      {% for key in k.get_choices %}
                                          <option value={{ key.0 }}>{{ key.1 }}</option>
                                      {% endfor %}
                                    </select>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="col-xs-12 col-sm-6">
                            {% for display_buttons in all_list_display_buttons %}
                                <button class="btn btn-primary"
                                        data-action="{{ display_buttons.action }}"
                                        v-on:click="{{ display_buttons.type }}">
                                    <i class="fa fa-plus"></i>
                                    {{ display_buttons.name }}
                                </button>
                            {% endfor %}
                        </div>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body table-responsive no-padding">
                    <table class="table table-hover" id="commonTable">
                        <thead>
                            <tr>
                                <th style="width:30px;">
                                    #
                                </th>
                                <th style="text-align: center;width:40px;">
                                    <input type="checkbox"
                                           name="checkboxAllRow"
                                           v-on:click="toggleAllBox"/>
                                </th>
                                <th v-for="key in columns"
                                    @click="sortBy(key[0])"
                                    :class="{active: sortKey == key[0]}">
                                    {!! key[1] | capitalize !!}
                                    <span class="arrow"
                                        :class="sortOrders[key[0]] > 0 ? 'asc' : 'dsc'">
                                    </span>
                                </th>
                                <th>
                                    操作
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <template v-for="item in items
                                                    | filterBy filterKey
                                                    | orderBy sortKey sortOrders[sortKey]">
                                <tr>
                                    <td style="width:30px;">#[$index+1]</td>
                                    <td style="width:40px;text-align:center">
                                        <input type="checkbox" class="minimal"
                                               name="checkboxRow"
                                               value="#[item.id]"/>
                                    </td>
                                    {% for field in list_display %}
                                        {% if field.0 == 'id' %}
                                            <td>
                                            {% for display_buttons in list_display_buttons %}
                                                <a href="javascript:void(0);"
                                                   data-pk="#[item.id]"
                                                   data-action="{{ display_buttons.action }}"
                                                   v-on:click="{{ display_buttons.type }}">
                                                    {{ display_buttons.name }}
                                                </a>
                                            {% endfor %}
                                            </td>
                                        {% else %}
                                            <td>
                                                {!! item.{{ field.0 }} !!}
                                            </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                {% block common_list_pagination %}
                    <div class="box-footer clearfix">
                        {% include 'adminlte/common_list_pagination.html' %}
                    </div>
                {% endblock %}
            </div>
        </div>
    </div>
{% endblock %}

{% block base_foot_page_script %}
    <script src="{% static 'web_apps/depn-list-page-base.js' %}"
            type="text/javascript"></script>
    <script>
    function time(){
        commonListPageVue.loadData({});
    }
    setInterval(time, 10000);
    </script>
    <script type="text/javascript">
        commonListPageVue.grifcolumns = [
            {% for title in list_display %}
                "{{ title.0 }}",
            {% endfor %}
        ];
        commonListPageVue.columns = [
            {% for title in list_display %}
                {% if title.0 != 'id' %}
                    ['{{ title.0 }}','{{ title.1.verbose_name }}'],
                {% endif %}
            {% endfor %}
        ];
        commonListPageVue.grifcolumns.forEach(function (key) {
            commonListPageVue.sortOrders[key] = 1
        })
    </script>
{% endblock %}