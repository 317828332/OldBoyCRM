{% extends "adminlte/base.html" %}
{% load static %}
{% block content_title %}
    {{ page_title }}
{% endblock %}

{% block base_head_style %}
    <style type="text/css">
        input[type='checkbox'] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
body {
  font-family: Helvetica Neue, Arial, sans-serif;
  font-size: 14px;
  color: #444;
}

table {
  border: 2px solid #42b983;
  border-radius: 3px;
  background-color: #fff;
}

th.active {
  color: #ffff00;
}

th.active .arrow {
  opacity: 1;
}

.arrow {
  display: inline-block;
  vertical-align: middle;
  width: 0;
  height: 0;
  margin-left: 5px;
  opacity: 0.66;
}

.arrow.asc {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-bottom: 4px solid #fff;
}

.arrow.dsc {
  border-left: 4px solid transparent;
  border-right: 4px solid transparent;
  border-top: 4px solid #fff;
}
    </style>
{% endblock %}

{% block content %}

    <div class="row" id="commonDataTableRow">
        <div class="col-xs-12">
            <div class="box">
                <div class="box-header">
                    <div class="row">
                        {% if list_filter %}
                        <div class="col-xs-12 col-sm-12">
                            <div id="sl-key" class="sl-key">
                                <h4>筛选器</h4>
                                {% for k in list_filter %}
                                    <span id="list_filter_{{ k }}">{{ k.verbose_name }} 选项:</span>
                                    <select onchange='commonListPageVue.search(this)' name="{{ k }}">
                                        <option value=''>请选择</option>
                                      {% for key in k.choices %}
                                          <option value={{ key.0 }}>{{ key.1 }}</option>
                                      {% endfor %}
                                    </select>
                                {% endfor %}
                            </div>
                        </div>
                        {% endif %}
                        <div class="col-xs-12 col-sm-6">
                            <h1></h1>
                            {% block common_list_buttons %}
                                {% for display_buttons in all_list_display_buttons %}
                                    <button class="btn btn-primary"
                                            data-action="{{ display_buttons.action }}"
                                            v-on:click="{{ display_buttons.type }}">
                                        <i class="fa fa-plus"></i>
                                        {{ display_buttons.name }}
                                    </button>
                                {% endfor %}
                            {% endblock %}
                        </div>
                        <div class="col-xs-12 col-sm-6">
                            <h1></h1>
                            <div class="input-group">
                                <input type="text" name="search"
                                       id="tableSearch"
                                       class="form-control input-sm pull-right"
                                       style="width: 150px;"
                                       placeholder="关键字"
                                       v-on:keypress.13="search">

                                <div class="input-group-btn">
                                    <button class="btn btn-sm btn-default"
                                            v-on:click="resetSearch">
                                        <i class="fa fa-times-circle"></i>
                                    </button>
                                    <button class="btn btn-sm btn-default"
                                            v-on:click="search">
                                        <i class="fa fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- /.box-header -->
                <div class="box-body table-responsive no-padding">
                    <table class="table table-hover" id="commonTable">
                        <thead>
                            <tr>
                                <th style="width:30px;">
                                    #
                                </th>
                                <th style="text-align: center;width:40px;">
                                    <input type="checkbox"
                                           name="checkboxAllRow"
                                           v-on:click="toggleAllBox"/>
                                </th>
                                <th v-for="key in columns"
                                    @click="sortBy(key[0])"
                                    :class="{active: sortKey == key[0]}">
                                    {!! key[1] | capitalize !!}
                                    <span class="arrow"
                                        :class="sortOrders[key[0]] > 0 ? 'asc' : 'dsc'">
                                    </span>
                                </th>
                                <th>
                                    操作
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <template v-for="item in items
                                                    | filterBy filterKey
                                                    | orderBy sortKey sortOrders[sortKey]">
                                <tr>
                                    <td style="width:30px;">#[$index+1]</td>
                                    <td style="width:40px;text-align:center">
                                        <input type="checkbox" class="minimal"
                                               name="checkboxRow"
                                               value="#[item.id]"/>
                                    </td>
                                    {% for field in list_display %}
                                        {% if field.0 == 'id' %}
                                            <td>
                                            {% for display_buttons in list_display_buttons %}
                                                <a href="javascript:void(0);"
                                                   data-pk="#[item.id]"
                                                   data-action="{{ display_buttons.action }}"
                                                   v-on:click="{{ display_buttons.type }}">
                                                    {{ display_buttons.name }}
                                                </a>
                                            {% endfor %}
                                            </td>
                                        {% else %}
                                            <td>
                                                {!! item.{{ field.0 }} !!}
                                            </td>
                                        {% endif %}
                                    {% endfor %}
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
                {% block common_list_pagination %}
                    <div class="box-footer clearfix">
                        {% include 'adminlte/common_list_pagination.html' %}
                    </div>
                {% endblock %}
            </div>
        </div>
    </div>
{% endblock %}

{% block base_foot_page_script %}
    <script src="{% static 'crm/common-list-page-base.js' %}"
            type="text/javascript"></script>
    {% block common_list_foot_page_script %}
        <script src="{% static 'crm/common-list-page.js' %}"
                type="text/javascript">

        </script>
        <script type="text/javascript">
        commonListPageVue.grifcolumns = [
            {% for title in list_display %}
                "{{ title.0 }}",
            {% endfor %}
        ];
        commonListPageVue.columns = [
            {% for title in list_display %}
                {% if title.0 != 'id' %}
                    ['{{ title.0 }}','{{ title.1.verbose_name }}'],
                {% endif %}
            {% endfor %}
        ];
        commonListPageVue.grifcolumns.forEach(function (key) {
            commonListPageVue.sortOrders[key] = 1
        })
        </script>
    {% endblock %}

{% endblock %}