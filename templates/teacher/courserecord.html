{% extends 'teacher/dashboard.html'%}
    {%block dash-filter%}
        <div class="panel">
            <div class="panel-heading">
                <h3 class="panel-title">{{ request.user }}老师您好，这是{{ courserecords.first.course_record }}详细情况</h3>
            </div>
            <div class="panel-body">
                <table id="demo-dt-basic" class="table table-striped table-bordered" cellspacing="0" width="100%">
                    <div>
                        <select class="set_all">
                            <option>设置所有已选择学生的签到状态</option>
                            <option value ="checked">全部设置为正常签到</option>
                            <option value ="noshow">全部设置为缺勤</option>
                            <option value ="late">全部设置为迟到</option>
                            <option value ="leave_early">全部设置为早退</option>
                        </select>
                    </div>
                    <thead>
                        <tr>
                            <th>
                                <button class="select_all">全选</button>
                                <button class="select_reserve">反选</button>
                            </th>
                            <th>学号</th>
                            <th>姓名</th>
                            <th>签到情况</th>
                            <th>成绩</th>
                            <th>备注</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for courserecord in courserecords %}
                            <tr student_id = '{{ courserecord.student_id }}', course_id = '{{ courserecord.course_record_id }}'>
                                <td>
                                    <input type="checkbox">
                                </td>
                                <td>{{ courserecord.student_id }}</td>
                                <td>{{ courserecord.student.name }}</td>
                                <td>
                                    <select class="record">
                                        <option></option>
                                        <option value ="checked">正常签到</option>
                                        <option value ="late">迟到</option>
                                        <option value ="noshow">缺勤</option>
                                        <option value ="leave_early">早退</option>
                                    </select>
                                </td>
                                <td>
                                    <select class="score">
                                        <option></option>
                                        <option value ="100">A+</option>
                                        <option value ="90">A</option>
                                        <option value ="85">B+<option>
                                        <option value ="80">B</option>
                                        <option value ="70">B-</option>
                                        <option value ="60">C+</option>
                                        <option value ="50">C</option>
                                        <option value ="40">C-</option>
                                        <option value ="0">D</option>
                                        <option value ="-1">N/A</option>
                                        <option value ="-100">COPY</option>
                                        <option value ="-1000">FAIL</option>
                                    </select>
                                </td>
                                <td>
                                    <input class="note" placeholder="{{ courserecord.note }}">
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    {% endblock %}


    {%block dash-footer-js%}
        <script>
            $(function () {
                {% for courserecord in courserecords %}
                    $("tr[student_id='{{ courserecord.student_id }}'][course_id='{{ courserecord.course_record_id }}").children("td").children(".record").children("[value='{{ courserecord.record }}']").attr('selected', 'selected')
                    $("tr[student_id='{{ courserecord.student_id }}'][course_id='{{ courserecord.course_record_id }}").children("td").children(".score").children("[value='{{ courserecord.score }}']").attr('selected', 'selected')
                {% endfor %}

                $('select.set_all').change(function () {
                    var all_information = $(this).val()
                    $("input[type='checkbox']:checked").parent().parent().find('select.record').val(all_information).trigger('change')
                })

                    $('button.select_all').click(function () {
                        $("input[type='checkbox']").prop('checked',true)
                    })

                    $('button.select_reserve').click(function () {
                        $("input[type='checkbox']").each(function(){
                            if($(this).prop('checked')){
                                $(this).prop('checked',false);
                            }else{
                                $(this).prop('checked',true);
                            }
                        })
                    })
                $('select.record,select.score,input.note').change(function () {
                    var student_id = $(this).parent().parent().attr('student_id');
                    console.log('student_id',student_id)
                    var course_id = $(this).parent().parent().attr('course_id');
                    console.log('course_id',course_id)
                    var status = $(this).attr('class');
                    console.log('status',status)
                    var information = $(this).val()
                    console.log('information', information)
                    $.ajax({
                        url: window.location.href,
                        type: 'POST',
                        data: {
                            student_id:student_id,
                            course_id:course_id,
                            status:status,
                            information:information,
                        },
                    })
                })
            })

        </script>
	{%endblock%}